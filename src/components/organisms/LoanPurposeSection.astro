---
import PurposeCard from '../molecules/Card/PurposeCard.astro';

export interface PurposeCardSpec {
  title: string;
  description: string;
  href: string;
  imageSrc: string;
  imageAlt: string;
  buttonText?: string;
  iconSrc?: string;
  iconAlt?: string;
  badge?: string;
  /** Optional per-card variant override */
  variant?: 'highlight' | 'normal';
  /** Optional admin toggle + text for badge (Keystatic convenience) */
  badgeEnabled?: boolean | 'yes' | 'no';
  badgeText?: string;
}

export interface Props {
  title: string;
  titleHighlight?: string;
  purposeCards: PurposeCardSpec[];
  variant?: 'default' | 'centered';
  /** Layout variant: featured-first emphasizes the first card */
  layout?: 'featured-first' | 'uniform';
  background?: 'white' | 'gray' | 'transparent';
  id?: string;
  /** Title highlight visual style */
  titleHighlightStyle?: 'underline' | 'pill';
  /** Section alignment */
  align?: 'left' | 'center';
}

const {
  title,
  titleHighlight,
  purposeCards,
  variant = 'default',
  layout = 'featured-first',
  background = 'white',
  id = 'loan-purpose',
  titleHighlightStyle = 'underline',
  align = 'center',
} = Astro.props;

// Split title at highlight point if provided
const titleParts = titleHighlight ? title.split(titleHighlight) : [title];
---

<section
  class={`hg-loan-purpose-section hg-loan-purpose-section--${variant} hg-loan-purpose-section--${background} hg-loan-purpose-section--layout-${layout} hg-loan-purpose-section--align-${align}`}
  id={id}
>
  <div class="hg-loan-purpose-container">
    <h2
      class:list={[
        'hg-loan-purpose-title',
        `hg-loan-purpose-title--${titleHighlightStyle}`,
      ]}
    >
      {titleParts[0]}
      {
        titleHighlight && (
          <span class="hg-loan-purpose-title-highlight">{titleHighlight}</span>
        )
      }
      {titleParts[1] || ''}
    </h2>

    <div class="hg-loan-purpose-grid">
      {
        purposeCards.map((card, index) => (
          <PurposeCard
            title={card.title}
            description={card.description}
            href={card.href}
            imageSrc={card.imageSrc}
            imageAlt={card.imageAlt}
            variant={
              (card.variant as any) ||
              (layout === 'featured-first' && index === 0
                ? 'highlight'
                : 'normal')
            }
            buttonText={card.buttonText}
            iconSrc={card.iconSrc}
            iconAlt={card.iconAlt}
            badge={
              card.badge ??
              (card.badgeEnabled === true || card.badgeEnabled === 'yes'
                ? card.badgeText || ''
                : undefined)
            }
            clickableCard={true}
          />
        ))
      }
    </div>
  </div>
</section>

<style>
  .hg-loan-purpose-section {
    padding: var(--space-xl) 0;
  }

  .hg-loan-purpose-section--white {
    background: var(--color-background-body);
  }

  .hg-loan-purpose-section--gray {
    background: var(--color-background-secondary);
  }

  .hg-loan-purpose-section--transparent {
    background: transparent;
  }

  .hg-loan-purpose-container {
    max-width: var(--size-container-content);
    margin: 0 auto;
    padding: 0 var(--space-lg);
  }

  .hg-loan-purpose-title {
    font-size: var(--font-size-4xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-text-heading);
    text-align: center;
    margin-bottom: var(--space-xl);
    line-height: var(--line-height-normal);
  }

  .hg-loan-purpose-section--centered .hg-loan-purpose-title {
    text-align: center;
  }

  .hg-loan-purpose-title-highlight {
    white-space: nowrap;
  }

  /* Title highlight styles */
  .hg-loan-purpose-title--underline .hg-loan-purpose-title-highlight {
    border-bottom: var(--border-width-sm) var(--border-style-solid)
      var(--color-interactive-primary);
  }

  .hg-loan-purpose-title--pill .hg-loan-purpose-title-highlight {
    background: var(--color-interactive-selection-background);
    border-radius: var(--radius-pill);
    padding: 0 var(--space-xs);
  }

  .hg-loan-purpose-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-lg);
    align-items: start;
    width: 100%;
  }

  .hg-loan-purpose-grid > * {
    width: 100%;
    min-width: 0;
  }

  /* Responsive grid adjustments */
  @media (width <= 64rem) {
    .hg-loan-purpose-grid {
      gap: var(--space-md);
    }
  }

  @media (width <= 48rem) {
    .hg-loan-purpose-section {
      padding: var(--space-xl) 0;
    }

    .hg-loan-purpose-container {
      padding: 0 var(--space-md);
    }

    .hg-loan-purpose-title {
      font-size: var(--font-size-2xl);
      margin-bottom: var(--space-lg);
    }

    .hg-loan-purpose-grid {
      grid-template-columns: 1fr;
      gap: var(--space-lg);
    }
  }

  @media (width <= 30rem) {
    .hg-loan-purpose-grid {
      gap: var(--space-sm);
    }
  }

  /* Enhanced spacing on large screens */
  @media (width >= 75rem) {
    .hg-loan-purpose-section {
      padding: var(--space-xl) 0;
    }

    .hg-loan-purpose-container {
      max-width: var(--size-container-wide);
    }

    .hg-loan-purpose-grid {
      gap: var(--space-xl);
    }
  }
</style>
