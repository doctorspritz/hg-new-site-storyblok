---
/* eslint-disable no-unused-vars */
export interface CheckboxOption {
  id: string;
  value: string;
  label: string;
  disabled?: boolean;
  required?: boolean;
}

export interface Props {
  name: string;
  label?: string;
  options: CheckboxOption[];
  selectedValues?: string[];
  error?: string;
  helperText?: string;
  required?: boolean;
  disabled?: boolean;
  variant?: 'default' | 'compact';
  size?: 'sm' | 'md' | 'lg';
  onChange?: (selectedValues: string[]) => void;
  class?: string;
}

const {
  name,
  label,
  options,
  selectedValues = [],
  error,
  helperText,
  required = false,
  disabled = false,
  variant = 'default',
  size = 'md',
  class: className = '',
} = Astro.props;

const groupId = `checkbox-group-${name}`;
const hasError = !!error;
const isDisabled = disabled;
const isRequired = required;

// Generate unique IDs for each checkbox
const checkboxIds = options.map(
  (option, index) => `${groupId}-${option.id || index}`,
);

// Note: selectedValues is used in template below
---

<div
  class:list={['checkbox-group', className]}
  data-variant={variant}
  data-size={size}
>
  {
    label && (
      <label for={groupId} class="checkbox-group-label">
        {label}
        {isRequired && (
          <span class="required-indicator" aria-label="required">
            *
          </span>
        )}
      </label>
    )
  }

  <div
    class="checkbox-group-options"
    role="group"
    aria-labelledby={label ? groupId : undefined}
  >
    {
      options.map((option, index) => {
        const checkboxId = checkboxIds[index];
        const isSelected = selectedValues.includes(option.value);
        const isOptionDisabled = isDisabled || option.disabled;

        return (
          <div
            class="checkbox-option"
            data-selected={isSelected}
            data-disabled={isOptionDisabled}
          >
            <input
              type="checkbox"
              id={checkboxId}
              name={name}
              value={option.value}
              checked={isSelected}
              disabled={isOptionDisabled}
              required={option.required || isRequired}
              class="checkbox-input"
              aria-describedby={helperText ? `${groupId}-helper` : undefined}
            />
            <label for={checkboxId} class="checkbox-option-label">
              <span class="bullet-icon">â€¢</span>
              {option.label}
              {option.required && (
                <span class="required-indicator" aria-label="required">
                  *
                </span>
              )}
            </label>
          </div>
        );
      })
    }
  </div>

  {
    helperText && (
      <div id={`${groupId}-helper`} class="helper-text" aria-live="polite">
        {helperText}
      </div>
    )
  }

  {
    hasError && (
      <div class="error-message" role="alert" aria-live="assertive">
        {error}
      </div>
    )
  }
</div>

<style>
  .checkbox-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    font-family: var(--font-family-base);
  }

  .checkbox-group-label {
    font-size: var(--font-size-md);
    font-weight: var(--font-weight-regular);
    color: var(--color-text-heading);
    margin-bottom: var(--space-xs);
    cursor: pointer;
  }

  .required-indicator {
    color: var(--color-feedback-error);
    margin-left: var(--space-2xs);
  }

  .checkbox-group-options {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .checkbox-option {
    display: flex;
    align-items: flex-start;
    gap: var(--space-sm);
    padding: var(--space-xs);
    border-radius: var(--radius-sm);
    transition: background-color var(--transition-duration-fast);
  }

  .checkbox-option:hover:not([data-disabled='true']) {
    background-color: var(--color-surface);
  }

  .checkbox-option[data-selected='true'] {
    background-color: var(--color-background-accent);
  }

  .checkbox-option[data-disabled='true'] {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .checkbox-input {
    margin: 0;
    width: var(--space-md);
    height: var(--space-md);
    accent-color: var(--color-interactive-primary);
    cursor: pointer;
  }

  .checkbox-input:disabled {
    cursor: not-allowed;
  }

  .checkbox-option-label {
    font-size: var(--font-size-md);
    color: var(--color-text-body);
    cursor: pointer;
    line-height: var(--line-height-normal);
    flex: 1;
    display: flex;
    align-items: flex-start;
    gap: var(--space-xs);
  }

  .bullet-icon {
    color: var(--color-interactive-primary);
    font-weight: var(--font-weight-bold);
    font-size: var(--font-size-lg);
    line-height: var(--line-height-tight);
    margin-top: var(--space-2xs);
    flex-shrink: 0;
  }

  .checkbox-option[data-disabled='true'] .checkbox-option-label {
    cursor: not-allowed;
    color: var(--color-text-subtle);
  }

  .helper-text {
    font-size: var(--font-size-sm);
    color: var(--color-text-subtle);
    margin-top: var(--space-xs);
  }

  .error-message {
    font-size: var(--font-size-sm);
    color: var(--color-feedback-error);
    margin-top: var(--space-xs);
    padding: var(--space-xs) var(--space-sm);
    background-color: var(--color-feedback-error);
    border-radius: var(--radius-sm);
    border-left: var(--border-width-sm) solid var(--color-feedback-error);
  }

  /* Variant styles */
  .checkbox-group[data-variant='compact'] .checkbox-group-options {
    gap: var(--space-xs);
  }

  .checkbox-group[data-variant='compact'] .checkbox-option {
    padding: var(--space-2xs);
  }

  /* Size styles */
  .checkbox-group[data-size='sm'] .checkbox-group-label {
    font-size: var(--font-size-sm);
  }

  .checkbox-group[data-size='sm'] .checkbox-option-label {
    font-size: var(--font-size-sm);
  }

  .checkbox-group[data-size='lg'] .checkbox-group-label {
    font-size: var(--font-size-lg);
  }

  .checkbox-group[data-size='lg'] .checkbox-option-label {
    font-size: var(--font-size-lg);
  }

  .checkbox-group[data-size='lg'] .checkbox-input {
    width: var(--space-lg);
    height: var(--space-lg);
  }
</style>
