---
/**
 * Molecule: PurposeCard
 * Loan purpose selection card with clean structure
 * Uses only design tokens - no external WordPress/Elementor variables
 */
import ButtonWithIcon from '../ButtonWithIcon.astro';
import Icon from '../../atoms/Icon.astro';

export interface Props {
  title: string;
  description: string;
  href: string;
  imageSrc: string;
  imageAlt: string;
  buttonText?: string;
  badge?: string;
  iconSrc?: string;
  iconAlt?: string;
  variant?: 'highlight' | 'normal';
  /** If true, makes the whole card clickable; CTA becomes a non-interactive affordance */
  clickableCard?: boolean;
  /** Text/media layout ratio */
  ratio?: '60-40' | '70-30';
  /** Image alignment within media area */
  imageAlign?: 'right' | 'center';
  class?: string;
}

const {
  title,
  description,
  href,
  imageSrc,
  imageAlt,
  buttonText = 'Learn More',
  badge,
  iconSrc,
  iconAlt,
  variant = 'normal',
  clickableCard = false,
  ratio = '70-30',
  imageAlign = 'right',
  class: className = '',
} = Astro.props;
---

{
  clickableCard ? (
    <a
      class={`hg-purpose-card hg-purpose-card--${variant} hg-purpose-card--r-${ratio} hg-purpose-card--img-${imageAlign} ${className}`}
      href={href}
    >
      {badge && <div class="hg-purpose-card-badge">{badge}</div>}

      <div class="hg-purpose-card-content">
        <div class="hg-purpose-card-title">
          {iconSrc && (
            <img
              src={iconSrc}
              alt={iconAlt || ''}
              class="hg-purpose-card-icon"
            />
          )}
          {title}
        </div>

        <div class="hg-purpose-card-description">{description}</div>

        <div class="hg-purpose-card-action">
          <span class="hg-purpose-card-cta-faux">
            {buttonText}
            <Icon
              name="chevron-right-bold"
              size="md"
              class="cta-arrow-icon"
              style="width: var(--size-icon-button-sm); height: var(--size-icon-button-sm); transform: translateY(var(--button-icon-baseline-adjust-sm));"
            />
          </span>
        </div>
      </div>

      <div class="hg-purpose-card-image">
        <img
          src={imageSrc}
          alt={imageAlt}
          width="100%"
          height="100%"
          loading="lazy"
        />
      </div>
    </a>
  ) : (
    <div
      class={`hg-purpose-card hg-purpose-card--${variant} hg-purpose-card--r-${ratio} hg-purpose-card--img-${imageAlign} ${className}`}
    >
      {badge && <div class="hg-purpose-card-badge">{badge}</div>}

      <div class="hg-purpose-card-content">
        <div class="hg-purpose-card-title">
          {iconSrc && (
            <img
              src={iconSrc}
              alt={iconAlt || ''}
              class="hg-purpose-card-icon"
            />
          )}
          {title}
        </div>

        <div class="hg-purpose-card-description">{description}</div>

        <div class="hg-purpose-card-action">
          <ButtonWithIcon
            href={href}
            variant="primary"
            size="md"
            iconName="chevron-right-bold"
            iconPosition="right"
          >
            {buttonText}
          </ButtonWithIcon>
        </div>
      </div>

      <div class="hg-purpose-card-image">
        <img
          src={imageSrc}
          alt={imageAlt}
          width="100%"
          height="100%"
          loading="lazy"
        />
      </div>
    </div>
  )
}

<style>
  /* Purpose Card - Clean Component Styles */
  .hg-purpose-card {
    position: relative;
    display: grid;
    grid-template-columns: 7fr 3fr; /* default ~70/30 ratio */
    align-items: center;
    width: 100%;
    height: 100%;
    border-radius: var(--radius-lg);
    background-color: var(--color-background-primary);
    box-shadow: var(--shadow-md);
    cursor: pointer;
    transition: transform var(--transition-duration-base)
      var(--transition-timing-function-ease);
    overflow: hidden;
    color: inherit; /* override base link styles for clickable root */
    text-decoration: none;
  }

  /* Ratio variants */
  .hg-purpose-card--r-70-30 {
    grid-template-columns: 7fr 3fr;
  }

  .hg-purpose-card--r-60-40 {
    grid-template-columns: 6fr 4fr;
  }

  .hg-purpose-card:hover {
    transform: translateY(calc(-1 * var(--space-xs)));
  }

  /* Color variants */
  .hg-purpose-card.hg-purpose-card--highlight {
    background-color: var(--color-background-light-accent);
    border: var(--border-width-sm) var(--border-style-solid)
      var(--color-border-subtle);
  }

  .hg-purpose-card.hg-purpose-card--normal {
    background-color: var(--color-background-secondary);
    border: var(--border-width-sm) var(--border-style-solid)
      var(--color-border-subtle);
  }

  /* Badge */
  .hg-purpose-card-badge {
    position: absolute;
    top: 0;
    right: 0;
    z-index: var(--z-index-sticky);
    background-color: var(--color-interactive-primary);
    color: var(--color-text-on-primary);
    padding: var(--space-xs) var(--space-md);
    border-radius: var(--radius-pill);
    margin: var(--space-sm);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-semibold);
    box-shadow: var(--shadow-sm);
  }

  /* Content */
  .hg-purpose-card-content {
    position: relative;
    z-index: 2;
    display: flex;
    flex-direction: column;
    height: 100%;
    gap: 0;
    padding: var(--space-lg);
    grid-column: 1;
  }

  .hg-purpose-card-title {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-text-heading);
    margin: 0 0 var(--space-md) 0;
    line-height: var(--line-height-tight);
  }

  .hg-purpose-card-icon {
    width: var(--size-icon-md);
    height: var(--size-icon-md);
    object-fit: contain;
    flex-shrink: 0;
  }

  .hg-purpose-card-description {
    flex: 1;
    font-size: var(--font-size-md);
    color: var(--color-text-body);
    line-height: var(--line-height-relaxed);
    margin: 0 0 var(--space-lg) 0;
  }

  .hg-purpose-card-action {
    margin-top: auto;
  }

  .hg-purpose-card-cta-faux {
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
    background: var(--color-interactive-primary);
    color: var(--color-text-on-primary);
    border-radius: var(--radius-pill);
    padding: var(--space-sm) var(--space-md);
    box-shadow: var(--shadow-sm);
  }

  .cta-arrow-icon {
    display: inline-flex;
    transform: translate(0, var(--button-icon-baseline-adjust-micro));
    transition: transform var(--transition-duration-fast)
      var(--transition-timing-function-ease);
    margin-left: var(--space-xs);
    vertical-align: middle;
    width: var(--size-icon-button-md);
    height: var(--size-icon-button-md);
  }

  .hg-purpose-card:hover .cta-arrow-icon {
    transform: translate(
      var(--space-2xs),
      var(--button-icon-baseline-adjust-micro)
    );
  }

  /* Background image */
  .hg-purpose-card-image {
    position: relative;
    grid-column: 2;
    width: 100%;
    height: 100%;
    z-index: 1;
    pointer-events: none; /* avoid blocking clicks */
    display: flex;
    align-items: flex-end; /* bottom-align media to card */
    justify-content: flex-end;
  }

  .hg-purpose-card-image img {
    width: 100%;
    height: auto; /* allow natural shrink on smaller screens */
    object-fit: contain; /* shrink to fit; do not crop */
    object-position: right center;
    transition: transform var(--transition-duration-base)
      var(--transition-timing-function-ease);
  }

  /* Image alignment variants */
  .hg-purpose-card--img-right .hg-purpose-card-image img {
    object-position: center right;
  }

  .hg-purpose-card--img-center .hg-purpose-card-image img {
    object-position: center;
  }

  .hg-purpose-card:hover .hg-purpose-card-image img {
    transform: scale(1.02);
  }

  /* Responsive adjustments */
  @media (width <= 48rem) {
    .hg-purpose-card {
      min-width: var(--size-container-narrow);

      /* Keep content and image side-by-side on mobile */
      display: grid;
      grid-template-columns: 6fr 4fr; /* ~60/40 on small screens */
    }

    .hg-purpose-card-content {
      max-width: 100%; /* allow full width for text column */
    }

    .hg-purpose-card-image {
      grid-column: 2;
      width: 100%;
      height: 100%;
      margin-top: 0;
    }

    .hg-purpose-card-title {
      font-size: var(--font-size-lg);
      margin-bottom: var(--space-sm);
    }

    .hg-purpose-card-description {
      font-size: var(--font-size-sm);
      margin-bottom: var(--space-md);
    }

    .hg-purpose-card:hover .hg-purpose-card-image img {
      transform: none;
    }
  }
</style>
