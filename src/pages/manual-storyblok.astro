---
import BaseLayout from '../layouts/BaseLayout.astro';

const PUBLIC_TOKEN = '2M8tuQ6eLmpwuw7WUhMccAtt';

let stories = [];
let error = null;

try {
  const response = await fetch(`https://api.storyblok.com/v2/cdn/stories?token=${PUBLIC_TOKEN}&version=published`);
  
  if (response.ok) {
    const data = await response.json();
    stories = data.stories || [];
  } else {
    error = `API Error: ${response.status} ${response.statusText}`;
  }
} catch (e) {
  error = e.message;
}
---

<BaseLayout title="Manual Storyblok Test">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6">Manual Storyblok API Test</h1>
    
    {error ? (
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        <strong>Error:</strong> {error}
      </div>
    ) : (
      <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
        <strong>Success!</strong> Manual API call worked!
      </div>
    )}
    
    <h2 class="text-2xl font-semibold mb-4">Stories Found: {stories.length}</h2>
    
    <div class="grid gap-4">
      {stories.map((story) => (
        <div class="border p-4 rounded">
          <h3 class="font-semibold">{story.name}</h3>
          <p class="text-sm text-gray-600">Slug: /{story.slug}</p>
          <p class="text-sm text-gray-600">ID: {story.id}</p>
          <p class="text-sm text-gray-600">Content Type: {story.content?.component || 'Unknown'}</p>
          <p class="text-sm text-gray-600">Published: {story.published_at}</p>
        </div>
      ))}
    </div>
    
    <div class="mt-8">
      <h3 class="text-xl font-semibold mb-4">API Details</h3>
      <p class="text-sm text-gray-600">Token: {PUBLIC_TOKEN}</p>
      <p class="text-sm text-gray-600">Endpoint: https://api.storyblok.com/v2/cdn/stories</p>
      <p class="text-sm text-gray-600">Version: published</p>
    </div>
  </div>
</BaseLayout>