---
import { useStoryblokApi } from '@storyblok/astro';
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro';
import BaseLayout from '../../layouts/BaseLayout.astro';

// Remove SSR requirement - use static generation
export async function getStaticPaths() {
  const storyblokApi = useStoryblokApi();
  const { data } = await storyblokApi.get('cdn/stories', {
    version: 'published',
  });
  
  const paths = data.stories.map(story => ({
    params: { slug: story.full_slug || story.slug }
  }));
  
  // Add home page
  paths.push({ params: { slug: undefined } });
  
  return paths;
}

const { slug } = Astro.params;
const storyblokApi = useStoryblokApi();

// Get the story
const { data } = await storyblokApi.get(`cdn/stories/${slug || 'home'}`, {
  version: 'published', // Use published for static generation
});

const story = data.story;
---

<BaseLayout title={story.name}>
  <StoryblokComponent blok={story.content} />
</BaseLayout>