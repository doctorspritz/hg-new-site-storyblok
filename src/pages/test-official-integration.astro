---
import { useStoryblokApi } from '@storyblok/astro';
import BaseLayout from '../layouts/BaseLayout.astro';

let stories = [];
let error = null;

try {
  const storyblokApi = useStoryblokApi();
  const { data } = await storyblokApi.get('cdn/stories', {
    version: 'published'
  });
  stories = data.stories || [];
} catch (e) {
  error = e.message;
  console.error('Storyblok Official Integration Error:', e);
}
---

<BaseLayout title="Official Storyblok Integration Test">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6">Official Storyblok Integration Test</h1>
    
    {error ? (
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        <strong>Error:</strong> {error}
      </div>
    ) : (
      <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
        <strong>Success!</strong> Official Storyblok Astro integration is working!
      </div>
    )}
    
    <h2 class="text-2xl font-semibold mb-4">Stories Found: {stories.length}</h2>
    
    <div class="grid gap-4">
      {stories.map((story) => (
        <div class="border p-4 rounded">
          <h3 class="font-semibold">{story.name}</h3>
          <p class="text-sm text-gray-600">Slug: /{story.slug}</p>
          <p class="text-sm text-gray-600">ID: {story.id}</p>
          <p class="text-sm text-gray-600">Content Type: {story.content?.component || 'Unknown'}</p>
        </div>
      ))}
    </div>
  </div>
</BaseLayout>